#!/bin/sh
set -e

MENU(){
    rofi -dmenu -i $@
}

search(){
    music=$(mpc playlist --format '%artist% : %title%' | sed '/^ : $/d' | MENU)
    if [ "$music" == "" ]
    then
        exit 1
    fi

    artist=$(echo "$music" | perl -pe 's/(.*) : (.*)/\1/')
    title=$(echo "$music"  | perl -pe 's/(.*) : (.*)/\2/')

    mpc searchplay artist "$artist" title "$title"
}

delete(){
    current=~/MÃºsica/"$(mpc current -f %file%)"
    answer=$(echo -e "nothing\n$current" | MENU -p"delete?" )
    if [ "$answer" == "$current" ]
    then
        trash "$answer"
        mpc next
        mpc update
    fi
}

usage(){
    echo "Commands: "
    echo "  $0 search     -- searches the current playlist for songs and plays it"
    echo "  $0 delete     --  prompts to delete the current song"
}

if [ "$1" == "delete" ]
then
    delete
elif [ "$1" == "search" ]
then
    search
else
    usage
fi
